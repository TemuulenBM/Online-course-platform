{
  "info": {
    "name": "OCP — Notifications Module",
    "description": "Online Course Platform — Notifications Module API\n\nPhase 4: Мэдэгдлийн модуль — мэдэгдэл жагсаалт, уншсан болгох, тохиргоо удирдах\n\n## Хэрэглэх дараалал\n1. Auth → Login (JWT token авах)\n2. GET /notifications/unread-count — Уншаагүй тоо\n3. GET /notifications — Жагсаалт (pagination + filter)\n4. GET /notifications/preferences — Тохиргоо авах\n5. PATCH /notifications/preferences — Тохиргоо шинэчлэх\n6. PATCH /notifications/:id/read — Нэг мэдэгдэл уншсан болгох\n7. PATCH /notifications/mark-all-read — Бүгдийг уншсан болгох\n8. DELETE /notifications/:id — Мэдэгдэл устгах\n\n## Урьдчилсан нөхцөл\n- DB-д хэрэглэгч бүртгэлтэй байх\n- Мэдэгдэл үүсгэсэн байх (NotificationService.send() дуудсан — бусад модулиас)\n\n## Variables\n- `baseUrl`: API URL (default: http://localhost:3001/api/v1)\n- `token`: JWT access token\n- `notificationId`: Мэдэгдлийн ID",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3001/api/v1", "type": "string" },
    { "key": "token", "value": "", "type": "string" },
    { "key": "notificationId", "value": "", "type": "string" }
  ],
  "item": [
    {
      "name": "01. Auth — Login",
      "item": [
        {
          "name": "Login (JWT авах)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.collectionVariables.set('token', res.data.accessToken);",
                  "  pm.test('Token saved', () => pm.expect(res.data.accessToken).to.be.a('string'));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"student@test.com\",\n  \"password\": \"Test12345\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "02. Notifications — Read",
      "item": [
        {
          "name": "GET Unread Count",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('count талбар байх', () => pm.expect(res.data.count).to.be.a('number'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/unread-count",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "unread-count"]
            }
          }
        },
        {
          "name": "GET List Notifications",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('data массив байх', () => pm.expect(res.data.data).to.be.an('array'));",
                  "pm.test('pagination талбарууд байх', () => {",
                  "  pm.expect(res.data.total).to.be.a('number');",
                  "  pm.expect(res.data.page).to.be.a('number');",
                  "  pm.expect(res.data.limit).to.be.a('number');",
                  "});",
                  "if (res.data.data.length > 0) {",
                  "  pm.collectionVariables.set('notificationId', res.data.data[0].id);",
                  "  pm.test('notificationId saved', () => pm.expect(res.data.data[0].id).to.be.a('string'));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            }
          }
        },
        {
          "name": "GET List Notifications — type filter",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('data массив байх', () => pm.expect(res.data.data).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications?page=1&limit=20&type=IN_APP",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "type", "value": "IN_APP" }
              ]
            }
          }
        },
        {
          "name": "GET List Notifications — read filter",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('data массив байх', () => pm.expect(res.data.data).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications?page=1&limit=20&read=false",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "read", "value": "false" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "03. Notifications — Preferences",
      "item": [
        {
          "name": "GET Preferences",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('emailEnabled талбар байх', () => pm.expect(res.data.emailEnabled).to.be.a('boolean'));",
                  "pm.test('pushEnabled талбар байх', () => pm.expect(res.data.pushEnabled).to.be.a('boolean'));",
                  "pm.test('smsEnabled талбар байх', () => pm.expect(res.data.smsEnabled).to.be.a('boolean'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/preferences",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "preferences"]
            }
          }
        },
        {
          "name": "PATCH Update Preferences",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('emailEnabled false болсон', () => pm.expect(res.data.emailEnabled).to.eql(false));",
                  "pm.test('smsEnabled true болсон', () => pm.expect(res.data.smsEnabled).to.eql(true));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emailEnabled\": false,\n  \"smsEnabled\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/preferences",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "preferences"]
            }
          }
        },
        {
          "name": "PATCH Restore Preferences",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('emailEnabled true болсон', () => pm.expect(res.data.emailEnabled).to.eql(true));",
                  "pm.test('smsEnabled false болсон', () => pm.expect(res.data.smsEnabled).to.eql(false));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emailEnabled\": true,\n  \"smsEnabled\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/preferences",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "preferences"]
            }
          }
        }
      ]
    },
    {
      "name": "04. Notifications — Actions",
      "item": [
        {
          "name": "PATCH Mark As Read",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('read true болсон', () => pm.expect(res.data.read).to.eql(true));",
                  "pm.test('readAt утга байх', () => pm.expect(res.data.readAt).to.not.be.null);"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}/read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}", "read"]
            }
          }
        },
        {
          "name": "PATCH Mark All Read",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('count талбар байх', () => pm.expect(res.data.count).to.be.a('number'));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/mark-all-read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "mark-all-read"]
            }
          }
        },
        {
          "name": "DELETE Notification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Амжилтын мессеж', () => pm.expect(res.data.message).to.include('устгагдлаа'));"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "05. Error Cases",
      "item": [
        {
          "name": "GET Without Token — 401",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/unread-count",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "unread-count"]
            }
          }
        },
        {
          "name": "PATCH Read — Not Found 404",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));"]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/00000000-0000-0000-0000-000000000000/read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "00000000-0000-0000-0000-000000000000", "read"]
            }
          }
        },
        {
          "name": "DELETE — Not Found 404",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));"]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{baseUrl}}/notifications/00000000-0000-0000-0000-000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "00000000-0000-0000-0000-000000000000"]
            }
          }
        }
      ]
    }
  ]
}
